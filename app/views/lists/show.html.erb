<!-- The user can view all list details. Link to add or delete movie/bookmark. Delete via icon -->
<!-- Navbar-->
<div class= "my-navbar">
  <div class="logo">
    <%= link_to image_tag("Logo.jpg", alt: "Logo", height: 60), lists_path %>
  </div>
  <div class="nav-links">
    <%= link_to "My lists", lists_path, class: "nav-link"%>
    <%= link_to "New list", new_list_path, class: "nav-link"%>
  </div>
</div>

<!-- Banner -->
<div class="banner" style="background-image: url('<%= image_path("default.jpg") %>');">
  <h1><%= @list.name %></h1>
  <p><%= pluralize(@list.bookmarks.count, 'movie') %> in this list</p>
</div>

<!-- Show existing bookmarks -->

  <div class="bookmarks-grid">
    <% @list.bookmarks.each do |bookmark| %>
      <div class="bookmark-card">
        <% if bookmark.movie.poster_url.present? %>
          <img src="<%= bookmark.movie.poster_url %>" alt="<%= bookmark.movie.title %>" class="poster">
        <% else %>
          <img src="<%= image_path('default.jpg') %>" alt="Default poster" class="poster">
        <% end %>
        <div class="bookmark-info">
          <h3><%= bookmark.movie.title %></h3>
          <p class="overview"><%= truncate(bookmark.movie.overview, length: 120) %></p>
          <p class="rating"><strong>‚≠ê <%= bookmark.movie.rating %></strong></p>
          <% if bookmark.comment.present? %>
            <p class="comment"><em>"<%= bookmark.comment %>"</em></p>
          <% end %>
        </div>

        <!-- Delete icon in bottom-right corner -->
        <%= link_to bookmark_path(bookmark),
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                    class: "delete-icon" do %>
          <i class="fa-solid fa-trash"></i>
        <% end %>
      </div>
    <% end %>
  </div>

<div class="btn-container">
    <!-- Add new bookmark button -->
  <button id="open-form" class="btn">Add a movie</button>
  <!-- Back to list button -->
  <%= link_to "Back to all lists", lists_path, class: "btn btn-secondary" %>
</div>

<!-- Hidden overlay form -->
<div id="form-overlay" class="overlay hidden">
  <div class="form-popup">
    <span id="close-form" class="close-btn">&times;</span>
    <h2>Add a movie to <%= @list.name %></h2>

    <%= simple_form_for [@list, @bookmark] do |f| %>
      <%= f.association :movie, collection: Movie.all, prompt: "Select a movie", label: "Movie" %>
      <%= f.input :comment, label: "Comment", placeholder: "Comment about this movie" %>
      <div class="form-actions">
        <%= f.submit "Add movie", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
<div class="review-container">
  <!-- Reviews Section -->
  <div class="reviews-section">

    <% @list.reviews.each do |review| %>
      <div class="review-card">
        <p><%= review.content %></p>
      </div>
    <% end %>

    <!-- New Review Form -->
    <div class="new-review">
      <%= form_with(model: [@list, Review.new], local: true) do |f| %>
        <div class="form-group">
          <%= f.text_area :content, placeholder: "Write your review...", rows: 3 %>
        </div>
        <div class="form-actions">
          <%= f.submit "Add Review", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
